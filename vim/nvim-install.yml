#f20 dependencies: 
#httpd httpd-tools libX11-devel libXtst-devel libXt-devel libSM-devel libXpm-devel ncurses-devel python2-devel gtk2-devel ruby-devel python3-devel cmake
#centos dependencies: 
#yum install --enablerepo="base,updates" httpd httpd-tools libX11-devel libXtst-devel libXt-devel libSM-devel libXpm-devel ncurses-devel python2-devel gtk2-devel ruby-devel python36-devel cmake git

#Add this to your .bashrc to enable this version of vim: 
#export PATH=${HOME}/vim-8.x/bin/:${PATH}
    - hosts: myservers
      #connection: local
      vars:
        neovim_git_dir: "{{ ansible_env.HOME }}/.ansible_build_dir/neovim/"
        neovim_install_dir: "{{ ansible_env.HOME }}/neovim-latest/"
        nvim_config_dir: "{{ ansible_env.HOME }}/.config/nvim"
        nvim_init_file: "{{ nvim_config_dir }}/init.lua"
        custom_nvimrc_path: "{{ playbook_dir }}/nvimrc.lua"

      tasks: 

        - name: Download Neovim
          git:
              repo: 'https://github.com/neovim/neovim.git'
              clone: yes
              dest: "{{ neovim_git_dir }}"
              depth: 1
              #version: 'v8.1.1142' #Disable if you want the latest

        - name: Make Neovim
          command: make CMAKE_BUILD_TYPE=RelWithDebInfo CMAKE_INSTALL_PREFIX={{ neovim_install_dir }}
          args: 
            chdir: "{{ neovim_git_dir }}"
            creates: "{{ neovim_git_dir }}/build/bin/nvim"

        - name: Install Neovim
          command: make install
          args: 
            chdir: "{{ neovim_git_dir }}"
            creates: "{{ neovim_install_dir }}/bin/nvim"

        - name: Ensure Neovim config directory exists
          file:
            path: "{{ nvim_config_dir }}"
            state: directory
            owner: "{{ ansible_env.USER }}"
            group: "{{ ansible_env.USER }}"
            mode: '0755'

        - name: Create Neovim init.lua with custom config path
          copy:
            dest: "{{ nvim_init_file }}"
            content: |
              dofile('{{ custom_nvimrc_path }}')
            owner: "{{ ansible_env.USER }}"
            group: "{{ ansible_env.USER }}"
            mode: '0644'
